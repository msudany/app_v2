{% extends "layout.html" %} {% block title %}Library{% endblock %} {% block content %}
        {% for status in ['Currently Reading', 'Want to Read', 'Read'] %}
        <section class="library-section">
            <h2>{{ status }}</h2>
            <div class="library-grid">
                {% for entry in progress if entry.status == status %}
                <div class="library-item">
                    <img src="{{ entry.book.cover_image or '/static/images/default_cover.png' }}" alt="{{ entry.book.title }} Cover">
                    <h3><a href="{{ url_for('book_details', book_id=entry.book.id) }}">{{ entry.book.title }}</a></h3>
                    <p><strong>Total Pages:</strong> {{ entry.book.pages }}</p>
                    <p><strong>Pages Left:</strong> {{ entry.pages_left }}</p>

                    <!-- Progress Update Form -->
                    {% if entry.status == 'Currently Reading' %}
                    <form action="{{ url_for('library') }}" method="POST">
                        <label for="pages_read_{{ entry.book.id }}">Pages Read:</label>
                        <input type="hidden" name="book_id" value="{{ entry.book.id }}">
                        <input type="number" id="pages_read_{{ entry.book.id }}" name="pages_read"
                               min="0" max="{{ entry.book.pages }}" value="{{ entry.pages_read }}">
                        <button type="submit" class="btn">Update Progress</button>
                    </form>
                    {% endif %}

                    <!-- Completed Badge -->
                    {% if entry.pages_read == entry.book.pages and entry.status == 'Currently Reading' %}
                    <span class="badge completed" onclick="document.getElementById('move_to_read_{{ entry.book.id }}').submit();">
                        Completed
                    </span>
                    <form id="move_to_read_{{ entry.book.id }}" action="{{ url_for('move_to_read', book_id=entry.book.id) }}" method="POST" style="display: none;">
                        <input type="hidden" name="book_id" value="{{ entry.book.id }}">
                    </form>
                    {% endif %}

                    <!-- Progress Bar -->
                    <div class="progress-bar">
                        <div class="progress" style="width: {{ (entry.pages_read / entry.book.pages) * 100 }}%;"></div>
                    </div>

                    <!-- Three-Dot Menu -->
                    <div class="menu-container">
                        <button class="menu-button">â‹®</button>
                        <div class="menu-dropdown">
                            <form action="{{ url_for('add_to_library', book_id=entry.book.id) }}" method="POST">
                                <input type="hidden" name="status" value="Currently Reading">
                                <button type="submit" class="menu-item">Move to Currently Reading</button>
                            </form>
                            <form action="{{ url_for('add_to_library', book_id=entry.book.id) }}" method="POST">
                                <input type="hidden" name="status" value="Want to Read">
                                <button type="submit" class="menu-item">Move to Want to Read</button>
                            </form>
                            <form action="{{ url_for('add_to_library', book_id=entry.book.id) }}" method="POST">
                                <input type="hidden" name="status" value="Read">
                                <button type="submit" class="menu-item">Move to Read</button>
                            </form>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endfor %}
{% endblock content %}
